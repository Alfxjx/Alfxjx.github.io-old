<!DOCTYPE html>
<html lang="">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="非常经典的一个问题。">




  <meta name="keywords" content="HTTP, Alfred's">










  <link rel="alternate" href="/default" title="Alfred's">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.2">



<link rel="canonical" href="http://yoursite.com/2019/01/02/从URL输入到页面展现/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.2">



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









<script>
  window.config = {"leancloud":"app_id:87EJk4r6rO0U0Tul5uju2IPq-gzGzoHsz app_key:vhxBampeF8Xel2ETEh4RBLNa","toc":true,"fancybox":true,"pjax":true};
</script>

    <title> 从URL输入到页面展现 - Alfred's </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Alfred's</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Alfred's</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              关于
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          从URL输入到页面展现
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-01-02
        </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1，url的输入"><span class="toc-text">1，url的输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2，DNS解析URL对应的IP，查找当前url是否存在缓存（cache）"><span class="toc-text">2，DNS解析URL对应的IP，查找当前url是否存在缓存（cache）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3，根据IP建立TCP连接（三次握手）"><span class="toc-text">3，根据IP建立TCP连接（三次握手）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4，HTTP发起请求"><span class="toc-text">4，HTTP发起请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5，服务器处理请求，返回一个HTTP响应"><span class="toc-text">5，服务器处理请求，返回一个HTTP响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6，浏览器接受返回值，渲染页面，构建DOM树"><span class="toc-text">6，浏览器接受返回值，渲染页面，构建DOM树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7，关闭TCP连接（四次挥手）"><span class="toc-text">7，关闭TCP连接（四次挥手）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考链接"><span class="toc-text">参考链接</span></a></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <h3 id="1，url的输入"><a href="#1，url的输入" class="headerlink" title="1，url的输入"></a>1，url的输入</h3><p>在浏览器的地址栏输入url，浏览器会自动查找历史记录以及书签中符合条件的数据。</p>
<p>URL（Uniform Resource Locator），统一资源定位符，实际就是网站网址，又称域名。在茫茫网络世界中，浏览器就是靠URL来查找资源位置。URL包含协议部分，是浏览器和www万维网之间的沟通方式，它会告诉浏览器正确在网路上找到资源位置。常见的协议有http、https、ftp、file、telnet等。其中http是最常见的网络传输协议，而https则是进行加密的网络传输。</p>
<h3 id="2，DNS解析URL对应的IP，查找当前url是否存在缓存（cache）"><a href="#2，DNS解析URL对应的IP，查找当前url是否存在缓存（cache）" class="headerlink" title="2，DNS解析URL对应的IP，查找当前url是否存在缓存（cache）"></a>2，DNS解析URL对应的IP，查找当前url是否存在缓存（cache）</h3><p>因此从输入URL开始，浏览器就要做域名解析，也就是IP寻址的工作。</p>
<p>  DNS（Domain Name System，域名系统）——记录域名和IP地址相互映射的信息，人们可以免于记住IP数串。全国DNS信息可在网上查找到，各省都有对应分配不同的IP网段。大型企业会有自己的DNS服务器，专门存储域名和IP的映射关系，例如为大多数人熟知的谷歌DNS服务器，地址8.8.8.8。</p>
<p>​       DNS解析是浏览器的实际<a href="https://link.jianshu.com?t=http://baike.baidu.com/view/889427.htm" target="_blank" rel="noopener">寻址方式</a>。IP寻址过程复杂，涉及多层设备和概念知识。在此，我只简单记录两种使用情况下的DNS解析方式，以作了解。</p>
<p>​       <strong>情况1：</strong>对于浏览器首次登陆或者相隔一段时间内登陆某个网站</p>
<p>​      （1）输入URL地址后，浏览器会从电脑C盘的hosts文件查找是否有存储DNS信息，查找是否有目标域名和对应的IP地址；</p>
<p>​      （2）从路由器的缓存DNS信息中查找；</p>
<p>​      （3）ISP DNS缓存查找，从网络服务商（比如电信）的DNS缓存信息中查找；</p>
<p>​      （4）经由以上三种查找方法还没查找到目标URL对应的IP的话，就会向根域名DNS服务器查找目标URL的对应IP，根域名服务器会向下级服务器转送请求，层层下发，直至找到对应IP为止。</p>
<p>​       <strong>情况2：</strong>对于近期内有在浏览器登录过的网站，本地浏览器会有DNS缓存，可以直接查找到IP地址。</p>
<p>​       经过以上IP寻址的过程，目标URL查找到对应的IP地址之后，通过IP地址查找到对应的服务器，浏览器将用户发起的http请求发送给服务器。下一步就到了服务器处理阶段的工作。</p>
<h3 id="3，根据IP建立TCP连接（三次握手）"><a href="#3，根据IP建立TCP连接（三次握手）" class="headerlink" title="3，根据IP建立TCP连接（三次握手）"></a>3，根据IP建立TCP连接（三次握手）</h3><p><a href="https://www.cnblogs.com/strick/p/5494869.html" target="_blank" rel="noopener">这里</a>介绍了TCP/IP协议的相关内容。</p>
<p><strong>为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误</strong></p>
<blockquote>
<p>第一次握手：客户端A将标志位SYN置为1,随机产生一个值为seq=J（J的取值范围为=1234567）的数据包到服务器，客户端A进入SYN_SENT状态，等待服务端B确认；</p>
</blockquote>
<blockquote>
<p>第二次握手：服务端B收到数据包后由标志位SYN=1知道客户端A请求建立连接，服务端B将标志位SYN和ACK都置为1，ack=J+1，随机产生一个值seq=K，并将该数据包发送给客户端A以确认连接请求，服务端B进入SYN_RCVD状态。</p>
</blockquote>
<blockquote>
<p>第三次握手：客户端A收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=K+1，并将该数据包发送给服务端B，服务端B检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，客户端A和服务端B进入ESTABLISHED状态，完成三次握手，随后客户端A与服务端B之间可以开始传输数据了。</p>
</blockquote>
<p><strong>TCP/IP分为4层：应用层、传输层、网络层、链路层。</strong></p>
<ol>
<li>发送端发送一个带SYN标志的数据包给对方</li>
<li>接收端回传一个带有SYN和ACK标志的数据包以示传达确认信息</li>
<li>发送端再回传一个带ACK标志的数据包，代表“握手结束”</li>
</ol>
<h3 id="4，HTTP发起请求"><a href="#4，HTTP发起请求" class="headerlink" title="4，HTTP发起请求"></a>4，HTTP发起请求</h3><p>HTTP（Hyper Text Transfer Protocol），超文本传输协议，由请求和响应构成。</p>
<p>一个典型的 http request header 一般需要包括请求的方法，例如 GET 或者 POST 等，不常用的还有 PUT 和 DELETE 、HEAD、OPTION以及 TRACE 方法，一般的浏览器只能发起 GET 或者 POST 请求。</p>
<p>客户端向服务器发起http请求的时候，会有一些请求信息，请求信息包含三个部分：</p>
<ul>
<li><p>请求方法URI协议/版本</p>
</li>
<li><p>请求头(Request Header)</p>
</li>
<li><p>请求正文</p>
</li>
</ul>
<pre><code class="http">GET/sample.jspHTTP/1.1
Accept:image/gif.image/jpeg,*/*
Accept-Language:zh-cn
Connection:Keep-Alive
Host:localhost
User-Agent:Mozila/4.0(compatible;MSIE5.01;Window NT5.0)
Accept-Encoding:gzip,deflate

username=jinqiao&amp;password=1234
</code></pre>
<h3 id="5，服务器处理请求，返回一个HTTP响应"><a href="#5，服务器处理请求，返回一个HTTP响应" class="headerlink" title="5，服务器处理请求，返回一个HTTP响应"></a>5，服务器处理请求，返回一个HTTP响应</h3><p>每台服务器上都会安装处理请求的应用——<strong>web server</strong>。常见的web server产品有apache、nginx、IIS或Lighttpd等。</p>
<p>​       <strong>web server 担任管控的角色</strong>，对于不同用户发送的请求，会结合配置文件，把不同请求委托给服务器上处理对应请求的程序进行处理（例如CGI脚本，JSP脚本，servlets，ASP脚本，服务器端JavaScript，或者一些其它的服务器端技术等），然后返回后台程序处理产生的结果作为响应。</p>
<p><strong>后端从在固定的端口接收到TCP报文开始，它会对TCP连接进行处理，对HTTP协议进行解析，并按照报文格式进一步封装成HTTP Request对象，供上层使用。</strong></p>
<p>　　一些大一点的网站会将你的请求到反向代理服务器中，因为当网站访问量非常大，网站越来越慢，一台服务器已经不够用了。于是将同一个应用部署在多台服务器上，将大量用户的请求分配给多台机器处理。此时，客户端不是直接通过HTTP协议访问某网站应用服务器，而是先请求到Nginx，Nginx再请求应用服务器，然后将结果返回给客户端，这里Nginx的作用是反向代理服务器。同时也带来了一个好处，其中一台服务器万一挂了，只要还有其他服务器正常运行，就不会影响用户使用。</p>
<p>HTTP响应与HTTP请求相似，HTTP响应也由3个部分构成，分别是：</p>
<ul>
<li><p>状态行</p>
</li>
<li><p>响应头(Response Header)</p>
</li>
<li><p>响应正文</p>
</li>
</ul>
<pre><code class="http">HTTP/1.1 200 OK
Date: Sat, 31 Dec 2005 23:59:59 GMT
Content-Type: text/html;charset=ISO-8859-1
Content-Length: 122

＜html＞
＜head＞
＜title＞http＜/title＞
＜/head＞
＜body＞
＜!-- body goes here --＞
＜/body＞
＜/html＞
</code></pre>
<h3 id="6，浏览器接受返回值，渲染页面，构建DOM树"><a href="#6，浏览器接受返回值，渲染页面，构建DOM树" class="headerlink" title="6，浏览器接受返回值，渲染页面，构建DOM树"></a>6，浏览器接受返回值，渲染页面，构建DOM树</h3><p>通过后台处理返回的html字符串结果会被浏览器读取解析，对应就是<strong>html页面加载、解析、渲染的工作。</strong></p>
<p>​       <strong>1、加载</strong></p>
<p>​       浏览器对一个html页面的加载顺序是从上而下的，并在加载过程并行进行解析渲染处理。在这个过程中遇到link标签、image标签、script标签时，<strong>浏览器会再次向服务器发送请求</strong>获取css文件、图片资源、js文件，并执行js代码，同步进行加载解析。</p>
<p>​        <strong>2、解析、渲染</strong></p>
<p>​        <strong>解析的过程，其实就是生成解析树，即dom树</strong>。dom树是由dom元素及属性节点组成，加上css解析的样式对象和js解析后的动作实现。而<strong>渲染，就是将DOM树进行可视化表示</strong>。下一步就来到了绘制网页的工作阶段。</p>
<blockquote>
<p>浏览器在解析html文件时，会”自上而下“加载，并在加载过程中进行解析渲染。在解析过程中，如果遇到请求外部资源时，如图片、外链的CSS、iconfont等，请求过程是异步的，并不会影响html文档进行加载。</p>
<p>　　解析过程中，浏览器<strong>首先会解析HTML文件构建DOM树</strong>，然后解析<strong>CSS文件</strong>构建渲染树，等到渲染树构建完成后，浏览器开始布局渲染树并将其绘制到屏幕上。这个过程比较复杂，涉及到两个概念: reflow(回流)和repain(重绘)。</p>
<p>　　DOM节点中的各个元素都是以盒模型的形式存在，这些都需要浏览器去计算其位置和大小等，这个过程称为relow;当盒模型的位置,大小以及其他属性，如颜色,字体,等确定下来之后，浏览器便开始绘制内容，这个过程称为repain。</p>
<p>　　页面在首次加载时必然会经历reflow和repain。reflow和repain过程是非常消耗性能的，尤其是在移动设备上，它会破坏用户体验，有时会造成页面卡顿。所以我们应该尽可能少的减少reflow和repain。</p>
<p>　当文档加载过程中遇到js文件，html文档会挂起渲染（加载解析渲染同步）的线程，不仅要等待文档中js文件加载完毕，还要等待解析执行完毕，才可以恢复html文档的渲染线程。因为JS有可能会修改DOM，最为经典的document.write，这意味着，在JS执行完成前，后续所有资源的下载可能是没有必要的，这是js阻塞后续资源下载的根本原因。所以我明平时的代码中，js是放在html文档末尾的。</p>
<p>　　<strong>JS的解析</strong>是由浏览器中的JS解析引擎完成的，比如谷歌的是V8。JS是单线程运行，也就是说，在同一个时间内只能做一件事，所有的任务都需要排队，前一个任务结束，后一个任务才能开始。但是又存在某些任务比较耗时，如IO读写等，所以需要一种机制可以先执行排在后面的任务，这就是：同步任务(synchronous)和异步任务(asynchronous)。</p>
<p>　　JS的执行机制就可以看做是一个主线程加上一个任务队列(task queue)。同步任务就是放在主线程上执行的任务，异步任务是放在任务队列中的任务。所有的同步任务在主线程上执行，形成一个执行栈;异步任务有了运行结果就会在任务队列中放置一个事件；脚本运行时先依次运行执行栈，然后会从任务队列里提取事件，运行任务队列中的任务，这个过程是不断重复的，所以又叫做事件循环(Event loop)。具体的过程可以看这篇文章：<a href="http://www.cnblogs.com/xianyulaodi/p/6414805.html" target="_blank" rel="noopener">点击这里</a></p>
</blockquote>
<h3 id="7，关闭TCP连接（四次挥手）"><a href="#7，关闭TCP连接（四次挥手）" class="headerlink" title="7，关闭TCP连接（四次挥手）"></a>7，关闭TCP连接（四次挥手）</h3><blockquote>
<p>第一次挥手：Client发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。</p>
</blockquote>
<blockquote>
<p>第二次挥手：Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。</p>
</blockquote>
<blockquote>
<p>第三次挥手：Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。</p>
</blockquote>
<blockquote>
<p>第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。</p>
</blockquote>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://www.jianshu.com/p/58e4597f9c7d" target="_blank" rel="noopener">说说从URL输入到页面展现的过程</a></p>
<p><a href="https://blog.csdn.net/wlk2064819994/article/details/79756669" target="_blank" rel="noopener">从输入URL到页面展示的详细过程</a></p>
<p><a href="https://www.cnblogs.com/strick/p/5494869.html" target="_blank" rel="noopener">输入URL到展现页面的全过程</a></p>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/HTTP/">HTTP</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2019/01/07/JS中的原型链与继承/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">JS中的原型链与继承</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2018/12/30/你有没有给自己设置一个长期的目标/">
        <span class="next-text nav-default">你有没有给自己设置一个长期的目标</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:xjxtju@163.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/Alfxjx" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2018 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Xu Jianxiang</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.2"></script>

  </body>
</html>
